<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Weather App</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

</head>

<body>

    <div class="container">
        <div class="weather-card">

            <h1 class="main-title">Weather App</h1>
            <p class="subtitle">Enter a city to see the current weather.</p>
            <div class="search-container">
                <input type="text" id="cityInput" placeholder="e.g., London, Tokyo, New York" class="input-field">
                <button id="searchButton" class="search-button">Get Weather</button>
            </div>

            <div id="loading" class="loading-spinner">
                <div class="spinner"></div>
            </div>

            <div id="weatherDisplay" class="weather-display">
                <div style="margin-bottom: 2rem;">
                    <h2 id="cityName" class="city-name"></h2>
                    <p id="temperature" class="temperature"></p>
                    <p id="description" class="description"></p>
                    <p id="wind" class="wind"></p>
                </div>

                <div id="forecast" class="forecast-grid">
                </div>
            </div>

            <div id="errorMessage" class="error-message">
                <p id="errorText"></p>
            </div>

        </div>

        <footer class="footer">
            © Bartonico, Ellieza Mae | Hubag, Ian Marvin | Mendiola, Reycel - BSIT 3A
        </footer>
    </div>

    <script>
        const cityInput = document.getElementById('cityInput');
        const searchButton = document.getElementById('searchButton');
        const weatherDisplay = document.getElementById('weatherDisplay');
        const loadingSpinner = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        async function fetchWeather(city) {
            if (!city) {
                showError('Please enter a city name.');
                return;
            }

            loadingSpinner.style.display = 'flex';
            weatherDisplay.style.display = 'none';
            errorMessage.style.display = 'none';

            try {
                const geoApiUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(city)}&format=json&limit=1`;
                const geoResponse = await fetch(geoApiUrl);
                const geoData = await geoResponse.json();

                if (geoData.length === 0) {
                    showError('City not found. Please try a more specific name.');
                    return;
                }

                const { lat, lon } = geoData[0];
                const cityName = geoData[0].display_name.split(',')[0];

                const weatherApiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,windspeed_10m_max,weathercode&timezone=auto`;
                const weatherResponse = await fetch(weatherApiUrl);
                const weatherData = await weatherResponse.json();

                if (weatherData.current_weather) {
                    displayWeather(weatherData, cityName);
                } else {
                    showError('Failed to retrieve weather data for this city.');
                }
            } catch (error) {
                showError('An error occurred. Please try again later.');
                console.error('Fetch error:', error);
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast', 45: 'Fog',
                48: 'Depositing rime fog', 51: 'Light drizzle', 53: 'Moderate drizzle', 55: 'Dense drizzle',
                56: 'Light freezing drizzle', 57: 'Dense freezing drizzle', 61: 'Slight rain',
                63: 'Moderate rain', 65: 'Heavy rain', 66: 'Light freezing rain', 67: 'Heavy freezing rain',
                71: 'Slight snow fall', 73: 'Moderate snow fall', 75: 'Heavy snow fall', 77: 'Snow grains',
                80: 'Slight showers', 81: 'Moderate showers', 82: 'Violent showers', 85: 'Slight snow showers',
                86: 'Heavy snow showers', 95: 'Thunderstorm', 96: 'Thunderstorm with slight hail',
                99: 'Thunderstorm with heavy hail'
            };
            return descriptions[code] || 'Weather condition not available';
        }

        function getWeatherInfo(wmoCode) {
            const descriptions = {
                // Clear and pleasant
                0: { description: 'Clear sky', color: 'bg-blue-300' },
                1: { description: 'Mainly clear', color: 'bg-blue-300' },
                2: { description: 'Partly cloudy', color: 'bg-blue-200' },
                // Cloudy and overcast
                3: { description: 'Overcast', color: 'bg-gray-400' },
                45: { description: 'Fog', color: 'bg-gray-300' },
                48: { description: 'Depositing rime fog', color: 'bg-gray-300' },
                // Drizzle and light rain
                51: { description: 'Light drizzle', color: 'bg-blue-400' },
                53: { description: 'Moderate drizzle', color: 'bg-blue-500' },
                55: { description: 'Dense drizzle', color: 'bg-blue-600' },
                56: { description: 'Light freezing drizzle', color: 'bg-blue-700' },
                57: { description: 'Dense freezing drizzle', color: 'bg-blue-800' },
                // Rain and showers
                61: { description: 'Slight rain', color: 'bg-blue-400' },
                63: { description: 'Moderate rain', color: 'bg-blue-500' },
                65: { description: 'Heavy rain', color: 'bg-blue-600' },
                66: { description: 'Light freezing rain', color: 'bg-blue-700' },
                67: { description: 'Heavy freezing rain', color: 'bg-blue-800' },
                80: { description: 'Slight showers', color: 'bg-blue-400' },
                81: { description: 'Moderate showers', color: 'bg-blue-500' },
                82: { description: 'Violent showers', color: 'bg-blue-600' },
                // Snow
                71: { description: 'Slight snow fall', color: 'bg-white-100' },
                73: { description: 'Moderate snow fall', color: 'bg-white-200' },
                75: { description: 'Heavy snow fall', color: 'bg-white-300' },
                77: { description: 'Snow grains', color: 'bg-white-200' },
                85: { description: 'Slight snow showers', color: 'bg-white-100' },
                86: { description: 'Heavy snow showers', color: 'bg-white-200' },
                // Thunderstorms and hail
                95: { description: 'Thunderstorm', color: 'bg-red-500' },
                96: { description: 'Thunderstorm with slight hail', color: 'bg-red-600' },
                99: { description: 'Thunderstorm with heavy hail', color: 'bg-red-700' },
            };

            const unknown = { description: 'Weather condition not available', color: 'bg-gray-500' };
            return descriptions[wmoCode] || unknown;
        }
        function displayWeather(data, city) {
            const currentWeather = data.current_weather;
            const dailyData = data.daily;

            const currentInfo = getWeatherInfo(currentWeather.weathercode);

            const weatherDisplay = document.getElementById('weatherDisplay');

            document.getElementById('cityName').innerText = city;
            document.getElementById('temperature').innerText = `${Math.round(currentWeather.temperature)}°C`;
            document.getElementById('description').innerText = currentInfo.description;
            document.getElementById('wind').innerText = `Wind: ${currentWeather.windspeed} km/h`;

            const forecastContainer = document.getElementById('forecast');
            forecastContainer.innerHTML = '';

            for (let i = 0; i < 3; i++) {
                const date = new Date(dailyData.time[i]);
                const dayOfWeek = date.toLocaleDateString('en-US', { weekday: 'short' });
                const weatherCode = dailyData.weathercode[i];

                const forecastInfo = getWeatherInfo(weatherCode);

                const forecastItem = document.createElement('div');

                forecastItem.className = `forecast-item ${forecastInfo.color}`;

                forecastItem.innerHTML = `
            <p class="forecast-day">${dayOfWeek}</p>
            <p class="forecast-temp">${Math.round(dailyData.temperature_2m_max[i])}° / ${Math.round(dailyData.temperature_2m_min[i])}°</p>
            <p class="forecast-desc">${forecastInfo.description}</p>
        `;
                forecastContainer.appendChild(forecastItem);
            }

            weatherDisplay.style.display = 'block';
        }

        function showError(message) {
            errorText.innerText = message;
            errorMessage.style.display = 'block';
            weatherDisplay.style.display = 'none';
        }

        searchButton.addEventListener('click', () => {
            const city = cityInput.value.trim();
            fetchWeather(city);
        });

        cityInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const city = cityInput.value.trim();
                fetchWeather(city);
            }
        });

        // fetchWeather('Manila');
    </script>
</body>

</html>